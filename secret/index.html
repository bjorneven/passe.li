<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
 integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
 crossorigin=""></script>
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
 <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/leaflet.geodesic"></script>

</head>

    <style>
        #mapid { height: 100%; width: 100%; }

    </style>
    <body>
        <div id="mapid"></div>

        <script>

            var mymap = L.map('mapid').setView([51.505, -0.09], 5);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: 'pk.eyJ1IjoiYmpvcm5ldmVuIiwiYSI6ImNrajY2emVnNzRjankycm40Z2U0cmkwMmYifQ.8SaqWp_StHtO4_Aqa7W5nA'
            }).addTo(mymap);
            L.Layer.include({
  getProps: function () {
    var feature = this.feature = this.feature || {}; // Initialize the feature, if missing.
    feature.type = 'Feature';
    feature.properties = feature.properties || {}; // Initialize the properties, if missing.
    return feature.properties;
  }
});

            $.getJSON('./route.json', function(routes) {

                routes.forEach(forEveryRoute)


            });

            

            function forEveryRoute(value, index, array) {

                var first = value.Fixes[0]
                var last = value.Fixes[value.Fixes.length - 1]
                
                L.circle([first.Lat, first.Lon], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 500
                }).addTo(mymap);
                L.circle([last.Lat, last.Lon], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 500
                }).addTo(mymap);

                var from = new L.LatLng(first.Lat, first.Lon); 
                var to = new L.LatLng(last.Lat, last.Lon); 
                var i;
                const places = []
                for (i = 0; i < value.Fixes.length; i++) {
                    var v =  value.Fixes[i]
                    var from = new L.LatLng(v.Lat, v.Lon); 
                    places.push(from)

                }

                const geodesicLine = new L.Geodesic(places)
                geodesicLine.getProps().name = first.DptAirport

                geodesicLine.addTo(mymap)
/*
                geodesicLine.on('mouseover',(e) => {
                    var source = event.sourceTarget;
                    console.log(source.getProps().name)
                });*/
            }
        </script>
    </body>
</html>